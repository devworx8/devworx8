# Dash AI Audit Tracker

## Scope
Program: `Dash AI/Orb Next-Gen Reliability + UX Program`

This tracker maps implementation work to acceptance criteria and rollout flags.

## Flags
- [x] `dash_unified_shell_v1`
- [x] `dash_voice_policy_v1`
- [x] `dash_phonics_quality_v1`
- [x] `dash_context_window_v1`
- [x] `dash_tutor_sessions_v1`
- [x] `dash_phoneme_mastery_v1`

## Phase 0 Baseline
- [ ] Checkpoint commit created before implementation
- [x] File-by-file tracker created (`dash_ai_audit.md`)
- [x] Turn telemetry fields added in app events
  - `conversation_id`
  - `turn_id`
  - `mode`
  - `tier`
  - `voice_provider`
  - `fallback_reason`
  - `latency_ms`

## Phase 1 Reliability Backbone
- [x] Tier source-of-truth helper expanded (`resolveEffectiveTier`)
- [x] Realtime tier hook uses shared resolver (`hooks/useRealtimeTier.ts`)
- [x] Tool registry capability normalization aligned (`UnifiedToolRegistry`)
- [x] Voice policy helper added (`lib/dash-ai/voicePolicy.ts`)
- [x] Freemium premium-voice quota behavior wired (`useVoiceTTS`)
- [x] 429 retry/backoff improved in AI client (`DashAIClient`)
- [x] STT transient network retry surfaced to UX (`expoProvider`, `dash-voice`, `voiceHandlers`)
- [x] Principal/dashboard routing moved toward unified shell (`dash-voice?mode=advisor|orb`)

## Phase 2 Unified Shell
- [x] Unified mode model introduced (`advisor|tutor|orb`)
- [x] Mode switch chips rendered in shell (`app/screens/dash-voice.tsx`)
- [x] Mode-aware quick actions and context prompting added
- [x] Header/title/status mode-aware
- [x] ORB handoff includes mode parameter

## Phase 3 Voice + Phonics Quality
- [x] Default speaking speed adjusted (>=1.0 baseline device speed)
- [x] Phonics normalization prevents slash marker readout
- [x] Digraph support in fallback phonics mapping (`sh`, `ch`, `th`, `ph`, `ng`)
- [x] STT post-correction for "It socks" -> "it's socks"
- [ ] End-to-end latency tuned to <1.5s p50 on production baseline

## Phase 4 Continuity + Context
- [x] Tier-based context windowing active (`conversationContext.ts`)
- [x] `messagesOverride` threaded through assistant stack
- [x] Orb handoff data normalized and resumed
- [x] Generated images rendered in chat surfaces
- [x] Tool-result summary card path added (raw output behind explicit action)

## Phase 5 Additive Data Model
- [x] `phonics_attempts` + `phoneme_mastery` migration exists
- [x] Heatmap helper exists (`getPhonemeHeatmap`)
- [x] Signed replay URL helper exists (`getPhonicsAttemptReplayUrl`)
- [x] Added migration: `tutor_sessions` table + RLS
- [x] Added app persistence service for tutor sessions (`tutorSessionService`)
- [x] Wired tutor session sync into assistant hook behind `dash_tutor_sessions_v1`

## Verification Checklist
- [ ] `npm run check:expo-filesystem` passes
- [ ] `npm run typecheck` passes for touched modules
- [ ] Native manual QA: voice retry UX, mode switching, tutor resume
- [ ] Supabase migration validation in staging

## Notes
- Existing in-flight dashboard work remains in tree and was not reverted.
- `dash_tutor_sessions_v1` defaults to opt-in (`EXPO_PUBLIC_DASH_TUTOR_SESSIONS_V1=true`).
